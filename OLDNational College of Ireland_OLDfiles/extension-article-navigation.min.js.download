(function(){"use strict";var a={RENDER:"articleNavigation:render"};window.ArticleNavigation=Util.createPlugin({defaults:{collection:{},articleId:null,nextTitle:"Next article",previousTitle:"Next article",labels:[],properties:["id","name","title","html_url","position","promoted","draft","section_id","category_id","created_at"],filter:{categories:function(a){return!0!==a.draft},sections:function(a){return!0!==a.draft},articles:function(a){return!0!==a.draft}},sort:{categories:"sortByPosition",sections:"sortByPosition",articles:"sortByPosition"},sortOrder:"asc",template:null,templateData:{}},optionTypes:{collection:"object",articleId:"(string|number|null)",nextTitle:"string",previousTitle:"string",labels:"(string|array)",properties:"(string|array)",sort:"(string|object)",sortOrder:"string",filter:"(string|object|null)",template:"(string|null)",templateData:"(string|object)"},initialize:function(a){for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];if("string"==typeof c&&/object|array/g.test(this.optionTypes[b]))try{this.options[b]=a[b]=JSON.parse(c)}catch(c){this.options[b]=a[b]=this.defaults[b],console.error("Option value ("+b+") is not a valid JSON string.")}}if(a.collection&&a.collection.hasOwnProperty("articles"))this.render(a.collection);else{if(!a.articleId){if(!Util.isArticlePage())return void console.error("An article ID must be specified");a.articleId=Util.getPageId()}this.getArticles(a.properties).then(this.render.bind(this))}},getArticles:function(a){var b=this.options,c=[],d="/api/v2/help_center/"+Util.locale+"/articles.json?include=categories,sections";return b.labels.length&&c.push("label_names="+b.labels.join(",")),c.length&&(d+="?"+c.join("&")),Util.request(d,a)},_sortArticles:function(a){var b=this._filterObjects(a.categories,"categories").reverse(),c=this._filterObjects(a.sections,"sections").reverse(),d=this._filterObjects(a.articles,"articles"),e=this._sortObjects.bind(this),f=[];return d=e(d,"articles"),e(b,"categories").forEach(function(a){e(c,"sections").forEach(function(b){if(b.category_id===a.id)for(var c,e=d.length;e--;)c=d[e],c.section_id===b.id&&(f.push(c),d.splice(e,1))})}),"desc"===this.options.sortOrder?f:f.reverse()},_filterObjects:function(a,b){var c=this.options;if(c.filter.hasOwnProperty(b)&&null!==c.sort[b]){if("function"==typeof c.filter[b])return a.filter(c.filter[b]);var d=c.filter[b];if("string"==typeof d&&"function"==typeof Util[d])return a.filter(Util[d])}return a},_sortObjects:function(a,b){var c=this.options,d={categories:this.sortByPosition,sections:this.sortByPosition,articles:this.sortByName};if(c.sort.hasOwnProperty(b)&&null!==c.sort[b]){if("function"==typeof c.sort[b])return a.sort(c.sort[b]);var e=c.sort[b];if("string"==typeof e&&"function"==typeof Util[e])return a.sort(Util[e])}return a.sort(d[b])},render:function(b){for(var c,d=this.options,e=this._sortArticles(b),f=0;f<e.length;f++)if(e[f].id===d.articleId){c=f;break}var g={nextTitle:this.options.nextTitle,currentArticle:e[c],previousTitle:this.options.previousTitle,previousArticle:0<=c-1?e[c-1]:null,nextArticle:c+1<e.length?e[c+1]:null};d.templateData&&(g=Util.extend(g,d.templateData)),Util.renderTemplate(this.el,d.template,g,{replaceContent:!0}),Util.triggerEvent(this.el,a.RENDER,{relatedTarget:this.el,articles:e})}}),window.addEventListener("load",function(){each("[data-element=\"article-navigation\"]",function(a){new ArticleNavigation(a)})})})();